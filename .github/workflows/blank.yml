      - name: Assemble ASM files to BIN
        run: |
          mkdir build

          for %%f in (*.asm) do (
            set "filename=%%~nf"
            echo Processing %%f â†’ !filename!.bin

            REM Detect mode by comment ;MODE=16 or ;MODE=32
            set "MODE=32"
            findstr /C:";MODE=16" "%%f" >nul && set "MODE=16"

            if "!MODE!"=="16" (
                echo Assembling 16-bit %%f
                ml /c /coff "%%f" /Fo"build\!filename!.obj" /I includes
                link /TINY /ENTRY:start "build\!filename!.obj" /OUT:"build\!filename!.exe"
            ) else (
                echo Assembling 32-bit %%f
                ml /c /coff "%%f" /Fo"build\!filename!.obj" /I includes
                link /SUBSYSTEM:NATIVE /ENTRY:main "build\!filename!.obj" /OUT:"build\!filename!.exe"
            )

            REM Convert .exe to raw binary
            copy /b "build\!filename!.exe" "build\!filename!.bin"
          )


